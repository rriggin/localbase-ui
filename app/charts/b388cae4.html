<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Line Chart - LocalBase</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        :root {
            /* LocalBase color palette adapted from Tide */
            --lb-blue: #5F8DFF;
            --lb-blue-dark: #3A6FE3;
            --lb-blue-light: #7BA4FF;
            --lb-black: #1E1E2E;
            --lb-gray-dark: #2A2A3C;
            --lb-gray-medium: #383850;
            --lb-gray-light: #4A4A65;
            --lb-green: #5DD6C7;
            --lb-green-light: #7FEDDF;
            --lb-white: #FFFFFF;
            --lb-orange: #FFB366;
            --lb-purple: #B794F6;
            
            /* UI palette */
            --background-dark: var(--lb-black);
            --background-sidebar: #252538;
            --text-color: var(--lb-white);
            --secondary-text: #B8B8D0;
            --border-color: #404060;
            --input-background: var(--lb-gray-dark);
            --primary-color: var(--lb-blue);
            --primary-hover: var(--lb-blue-light);
            --accent-color: var(--lb-green);
            --success-color: var(--lb-green);
            --warning-color: var(--lb-orange);
            --info-color: var(--lb-purple);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: var(--background-dark);
            color: var(--text-color);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background-color: var(--background-sidebar);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-color);
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .logo:hover {
            opacity: 0.8;
        }

        .logo .highlight {
            color: var(--primary-color);
        }

        .nav-items {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-item {
            color: var(--secondary-text);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-item:hover {
            color: var(--text-color);
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        /* Main Layout */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            min-height: calc(100vh - 80px);
        }

        /* Content Sections */
        .content-section {
            margin-bottom: 40px;
        }

        .section-header {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        .section-subtitle {
            color: var(--secondary-text);
            font-size: 16px;
        }

        /* Cards */
        .card {
            background-color: var(--lb-gray-dark);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 4px;
        }

        .card-subtitle {
            color: var(--secondary-text);
            font-size: 14px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--lb-white);
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-secondary {
            background-color: var(--lb-gray-medium);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: var(--lb-gray-light);
        }

        /* Grid Layout */
        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        /* Utilities */
        .text-center {
            text-align: center;
        }

        .text-muted {
            color: var(--secondary-text);
        }

        .mb-2 { margin-bottom: 16px; }
        .mb-3 { margin-bottom: 24px; }

        /* Chart Specific Styles */
        .chart-container {
            background-color: var(--lb-gray-dark);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .chart-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 16px;
            background-color: var(--lb-gray-medium);
            border-radius: 8px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-group label {
            font-weight: 500;
            font-size: 14px;
            color: var(--text-color);
        }

        select {
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--input-background);
            color: var(--text-color);
            font-size: 14px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }

        .legend-item:hover {
            background-color: var(--lb-gray-medium);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .legend-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
        }

        .chart-svg {
            width: 100%;
            height: 400px;
            background-color: var(--lb-gray-medium);
            border-radius: 8px;
        }

        /* D3 Chart Styles */
        .line {
            fill: none;
            stroke-width: 2.5;
        }

        .axis {
            font-size: 12px;
            color: var(--secondary-text);
        }

        .axis text {
            fill: var(--secondary-text);
        }

        .axis path,
        .axis line {
            stroke: var(--border-color);
        }

        .grid-line {
            stroke: var(--border-color);
            stroke-width: 1;
            opacity: 0.3;
        }

        .tooltip {
            position: absolute;
            background: rgba(30, 30, 46, 0.95);
            color: var(--text-color);
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tooltip-title {
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 13px;
            color: var(--text-color);
        }

        .tooltip-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 3px 0;
            color: var(--text-color);
        }

        .tooltip-color {
            width: 8px;
            height: 8px;
            border-radius: 1px;
        }

        .hover-line {
            stroke: var(--secondary-text);
            stroke-width: 1;
            stroke-dasharray: 3,3;
            opacity: 0;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="../gallery.html" class="logo" style="text-decoration: none;">
                Local<span class="highlight">Base</span>
            </a>
            <nav class="nav-items">
                <a href="../index.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    App Home
                </a>
                <a href="../dashboard.html" class="nav-item">
                    <i class="fas fa-chart-bar"></i>
                    Dashboard
                </a>
                <a href="../gallery.html" class="nav-item">
                    <i class="fas fa-layer-group"></i>
                    Gallery
                </a>
                <a href="#" class="nav-item active">
                    <i class="fas fa-chart-line"></i>
                    Multi-Line Chart
                </a>
            </nav>
        </div>
    </header>

    <main class="main-container">
        <div class="content-section">
            <div class="section-header text-center">
                <h1 class="section-title">
                    <i class="fas fa-chart-line" style="color: var(--primary-color); margin-right: 12px;"></i>
                    Multi-Line Chart
                </h1>
                <p class="section-subtitle">Interactive time series visualization with multiple data series</p>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Chart Controls</h2>
                <p class="card-subtitle">Configure your multi-line chart display options</p>
            </div>
            
            <div class="chart-controls">
                <div class="control-group">
                    <label for="timeRange">Time Range:</label>
                    <select id="timeRange">
                        <option value="all">All Time</option>
                        <option value="30">Last 30 Days</option>
                        <option value="90" selected>Last 90 Days</option>
                    </select>
                </div>
                <div class="control-group">
                    <button class="btn btn-secondary" onclick="toggleAllLines()">
                        <i class="fas fa-eye"></i>
                        Toggle All
                    </button>
                    <button class="btn btn-secondary" onclick="resetZoom()">
                        <i class="fas fa-expand-arrows-alt"></i>
                        Reset View
                    </button>
                </div>
            </div>

            <div class="legend" id="legend"></div>
            
            <div class="chart-container">
                <svg class="chart-svg" id="chartSvg"></svg>
            </div>
        </div>

        <div class="grid grid-2">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-info-circle" style="color: var(--info-color);"></i>
                        Usage Instructions
                    </h3>
                </div>
                <ul style="color: var(--secondary-text); line-height: 1.6;">
                    <li><strong>Hover:</strong> Show detailed tooltips with data values</li>
                    <li><strong>Legend:</strong> Click series names to toggle visibility</li>
                    <li><strong>Time Range:</strong> Filter data to specific time periods</li>
                    <li><strong>Toggle All:</strong> Show/hide all data series at once</li>
                    <li><strong>Reset View:</strong> Return to original zoom and scale</li>
                </ul>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-download" style="color: var(--success-color);"></i>
                        Export Options
                    </h3>
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="exportData()">
                        <i class="fas fa-file-csv"></i>
                        Export CSV
                    </button>
                    <button class="btn btn-secondary" onclick="exportImage()">
                        <i class="fas fa-image"></i>
                        Export PNG
                    </button>
                </div>
            </div>
        </div>
    </main>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // Sample data - replace with your actual data
        const sampleData = [
            {"date": "2025-05-03", "series_1": 180.23, "series_2": 120.45, "series_3": 250.12},
            {"date": "2025-05-04", "series_1": 165.44, "series_2": 110.33, "series_3": 245.88},
            {"date": "2025-05-05", "series_1": 195.67, "series_2": 125.78, "series_3": 268.45},
            {"date": "2025-05-06", "series_1": 172.89, "series_2": 118.90, "series_3": 255.67},
            {"date": "2025-05-07", "series_1": 188.34, "series_2": 132.56, "series_3": 278.90}
        ];
        
        // Chart configuration
        let chartData = sampleData;
        let series = [];
        let svg, xScale, yScale, line, parseTime, formatTime;
        
        // Chart dimensions
        const margin = { top: 20, right: 60, bottom: 60, left: 60 };
        const width = 1100 - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;
        
        // LocalBase color scheme for lines
        const colorScale = d3.scaleOrdinal([
            '#5F8DFF', '#5DD6C7', '#FFB366', '#B794F6', '#7BA4FF'
        ]);
        
        function initializeChart(data = chartData) {
            // Parse data
            parseTime = d3.timeParse("%Y-%m-%d");
            formatTime = d3.timeFormat("%b %d, %Y");
            
            const processedData = data.map(d => ({
                date: parseTime(d.date),
                ...d
            })).sort((a, b) => a.date - b.date);
            
            // Get series keys (all keys except 'date')
            const seriesKeys = Object.keys(data[0]).filter(key => key !== 'date');
            
            // Transform data for D3
            series = seriesKeys.map(key => ({
                name: key,
                displayName: key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                values: processedData.map(d => ({
                    date: d.date,
                    value: +d[key] || 0
                })),
                visible: true
            }));
            
            // Set up SVG
            d3.select("#chartSvg").selectAll("*").remove();
            svg = d3.select("#chartSvg")
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
            
            // Set up scales
            xScale = d3.scaleTime()
                .domain(d3.extent(processedData, d => d.date))
                .range([0, width]);
            
            yScale = d3.scaleLinear()
                .domain([0, d3.max(series, s => d3.max(s.values, d => d.value))])
                .nice()
                .range([height, 0]);
            
            // Line generator
            line = d3.line()
                .x(d => xScale(d.date))
                .y(d => yScale(d.value))
                .curve(d3.curveMonotoneX);
            
            drawChart();
            createLegend();
        }
        
        function drawChart() {
            // Add grid lines
            svg.append("g")
                .attr("class", "grid")
                .selectAll("line")
                .data(yScale.ticks())
                .enter().append("line")
                .attr("class", "grid-line")
                .attr("x1", 0)
                .attr("x2", width)
                .attr("y1", d => yScale(d))
                .attr("y2", d => yScale(d));
            
            // Add axes
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(xScale).tickFormat(d3.timeFormat("%b %d")));
            
            svg.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(yScale));
            
            // Add lines
            const lineGroups = svg.selectAll(".line-group")
                .data(series)
                .enter().append("g")
                .attr("class", "line-group");
            
            lineGroups.append("path")
                .attr("class", "line")
                .attr("d", d => line(d.values))
                .style("stroke", (d, i) => colorScale(i))
                .style("opacity", d => d.visible ? 1 : 0);
            
            addInteractivity();
        }
        
        function addInteractivity() {
            const tooltip = d3.select("#tooltip");
            
            // Hover line
            const hoverLine = svg.append("line")
                .attr("class", "hover-line")
                .attr("y1", 0)
                .attr("y2", height);
            
            // Mouse events
            svg.append("rect")
                .attr("width", width)
                .attr("height", height)
                .style("fill", "none")
                .style("pointer-events", "all")
                .on("mouseover", function() {
                    hoverLine.style("opacity", 1);
                })
                .on("mouseout", function() {
                    hoverLine.style("opacity", 0);
                    tooltip.style("opacity", 0);
                })
                .on("mousemove", function(event) {
                    const [mouseX] = d3.pointer(event, this);
                    const date = xScale.invert(mouseX);
                    
                    // Find closest data point
                    const bisectDate = d3.bisector(d => d.date).left;
                    const dataIndex = bisectDate(chartData.map(d => parseTime(d.date)), date, 1);
                    const d0 = chartData[dataIndex - 1];
                    const d1 = chartData[dataIndex];
                    const d = date - parseTime(d0?.date) > parseTime(d1?.date) - date ? d1 : d0;
                    
                    if (d) {
                        hoverLine
                            .attr("x1", xScale(parseTime(d.date)))
                            .attr("x2", xScale(parseTime(d.date)));
                        
                        // Show tooltip
                        const seriesKeys = Object.keys(d).filter(key => key !== 'date');
                        const tooltipContent = `
                            <div class="tooltip-title">${formatTime(parseTime(d.date))}</div>
                            ${seriesKeys.map((key, i) => `
                                <div class="tooltip-item">
                                    <div class="tooltip-color" style="background: ${colorScale(i)}"></div>
                                    <span>${key.replace(/_/g, ' ')}: ${(d[key] || 0).toFixed(2)}</span>
                                </div>
                            `).join('')}
                        `;
                        
                        tooltip
                            .html(tooltipContent)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 10) + "px")
                            .style("opacity", 1);
                    }
                });
        }
        
        function createLegend() {
            const legend = d3.select("#legend");
            legend.selectAll("*").remove();
            
            const legendItems = legend.selectAll(".legend-item")
                .data(series)
                .enter().append("div")
                .attr("class", "legend-item")
                .on("click", function(event, d) {
                    d.visible = !d.visible;
                    updateChart();
                    updateLegend();
                });
            
            legendItems.append("div")
                .attr("class", "legend-color")
                .style("background", (d, i) => colorScale(i));
            
            legendItems.append("span")
                .attr("class", "legend-label")
                .text(d => d.displayName);
        }
        
        function updateChart() {
            svg.selectAll(".line")
                .style("opacity", d => d.visible ? 1 : 0);
        }
        
        function updateLegend() {
            d3.select("#legend").selectAll(".legend-item")
                .style("opacity", d => d.visible ? 1 : 0.5);
        }
        
        function toggleAllLines() {
            const allVisible = series.every(d => d.visible);
            series.forEach(d => d.visible = !allVisible);
            updateChart();
            updateLegend();
        }
        
        function resetZoom() {
            initializeChart();
        }
        
        function exportData() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "date," + Object.keys(chartData[0]).filter(k => k !== 'date').join(',') + "\n"
                + chartData.map(row => Object.values(row).join(',')).join('\n');
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "multi_line_chart_data.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function exportImage() {
            // SVG to PNG export functionality would go here
            alert('PNG export feature coming soon!');
        }
        
        // Initialize chart when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeChart();
            console.log("ðŸ“Š LocalBase Multi-Line Chart initialized!");
        });
        
        // Time range filter
        document.getElementById('timeRange').addEventListener('change', function() {
            // Time filtering logic would be implemented here
            console.log('Time range changed to:', this.value);
        });
    </script>
</body>
</html>