<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Ads Performance - LocalBase</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        :root {
            --lb-blue: #5F8DFF;
            --lb-black: #1E1E2E;
            --lb-gray-dark: #2A2A3C;
            --lb-gray-medium: #383850;
            --lb-white: #FFFFFF;
            --lb-green: #5DD6C7;
            --lb-orange: #FFB366;
            --lb-purple: #B794F6;
            --text-color: var(--lb-white);
            --secondary-text: #B8B8D0;
            --border-color: #404060;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--lb-black);
            color: var(--text-color);
            padding: 20px;
        }

        .header {
            background-color: var(--lb-gray-medium);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
            margin-bottom: 30px;
            border-radius: 8px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-color);
        }

        .logo .highlight {
            color: var(--lb-blue);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .title {
            font-size: 32px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
            text-align: center;
        }

        .subtitle {
            color: var(--secondary-text);
            font-size: 16px;
            text-align: center;
            margin-bottom: 30px;
        }

        .chart-card {
            background-color: var(--lb-gray-dark);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 24px;
            margin-bottom: 20px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }

        .legend-item:hover {
            background-color: var(--lb-gray-medium);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .legend-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
        }

        #chart {
            width: 100%;
            height: 400px;
            background-color: var(--lb-gray-medium);
            border-radius: 8px;
        }

        .line {
            fill: none;
            stroke-width: 3;
        }

        .axis {
            font-size: 12px;
        }

        .axis text {
            fill: var(--secondary-text);
        }

        .axis path,
        .axis line {
            stroke: var(--border-color);
        }

        .grid-line {
            stroke: var(--border-color);
            stroke-width: 1;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    Local<span class="highlight">Base</span>
                </div>
                <nav>
                    <a href="gallery.html" style="color: var(--secondary-text); text-decoration: none;">
                        <i class="fas fa-layer-group"></i> Gallery
                    </a>
                </nav>
            </div>
        </header>

        <h1 class="title">üöÅ Google Ads Performance</h1>
        <p class="subtitle">Campaign spend over time - LocalBase Analytics</p>
        
        <div class="chart-card">
            <div class="legend" id="legend"></div>
            <svg id="chart"></svg>
        </div>
    </div>

    <script>
        console.log("üöÄ Starting Google Ads chart...");

        // Full Google Ads campaign data - 91 days
        // Data will be loaded externally

        console.log("üìä Raw data loaded:", rawData.length, "records");

        // Chart setup
        const margin = { top: 20, right: 60, bottom: 60, left: 60 };
        const width = 1100 - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;

        const colors = ['#5F8DFF', '#5DD6C7', '#FFB366', '#B794F6', '#7BA4FF'];
        
        // Process data - convert date strings to Date objects
        const data = rawData.map(d => ({
            ...d,
            date: new Date(d.date + 'T00:00:00') // Ensure consistent parsing
        }));

        console.log("üìÖ Processed data sample:", data[0]);

        const campaigns = ['roofmaxx_kc_roof_restoration', 'kc_roof_restoration', 'roofmaxx_storm_damage', 'roof_maintenance_services', 'commercial_roofing_kc'];
        
        const series = campaigns.map((campaign, i) => ({
            name: campaign,
            displayName: campaign.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
            color: colors[i],
            visible: true,
            values: data.map(d => ({ 
                date: d.date, 
                value: parseFloat(d[campaign]) || 0 
            }))
        }));

        console.log("üìà Series created:", series.length);
        console.log("üìà First series sample:", series[0].values.slice(0, 3));

        // Create SVG
        const svg = d3.select("#chart")
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Scales
        const xExtent = d3.extent(data, d => d.date);
        console.log("üìÖ Date extent:", xExtent);

        const xScale = d3.scaleTime()
            .domain(xExtent)
            .range([0, width]);

        const maxValue = d3.max(series, s => d3.max(s.values, d => d.value));
        console.log("üìä Max value:", maxValue);

        const yScale = d3.scaleLinear()
            .domain([0, maxValue])
            .nice()
            .range([height, 0]);

        // Line generator
        const line = d3.line()
            .x(d => xScale(d.date))
            .y(d => yScale(d.value))
            .curve(d3.curveMonotoneX);

        // Test line generation
        console.log("üß™ Testing line generation...");
        series.forEach((s, i) => {
            const path = line(s.values);
            console.log(`üìà Line ${i} (${s.name}):`, path ? "‚úÖ Valid" : "‚ùå Invalid");
            if (!path) {
                console.log("üîç Sample values:", s.values.slice(0, 3));
            }
        });

        // Add grid
        svg.append("g")
            .attr("class", "grid")
            .selectAll("line")
            .data(yScale.ticks())
            .enter().append("line")
            .attr("class", "grid-line")
            .attr("x1", 0)
            .attr("x2", width)
            .attr("y1", d => yScale(d))
            .attr("y2", d => yScale(d));

        // Add axes
        svg.append("g")
            .attr("class", "axis")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xScale).tickFormat(d3.timeFormat("%b %d")));

        svg.append("g")
            .attr("class", "axis")
            .call(d3.axisLeft(yScale).tickFormat(d => `$${d}`));

        // Add lines
        console.log("üé® Drawing lines...");
        series.forEach((s, i) => {
            const pathElement = svg.append("path")
                .datum(s.values)
                .attr("class", "line")
                .attr("id", `line-${i}`)
                .attr("d", line)
                .style("stroke", s.color)
                .style("opacity", s.visible ? 1 : 0);
            
            console.log(`üé® Line ${i} rendered:`, pathElement.node() ? "‚úÖ Success" : "‚ùå Failed");
        });

        // Create legend
        const legend = d3.select("#legend");
        series.forEach((s, i) => {
            const item = legend.append("div")
                .attr("class", "legend-item")
                .style("cursor", "pointer")
                .on("click", () => {
                    s.visible = !s.visible;
                    d3.select(`#line-${i}`).style("opacity", s.visible ? 1 : 0);
                    item.style("opacity", s.visible ? 1 : 0.5);
                });

            item.append("div")
                .attr("class", "legend-color")
                .style("background", s.color);

            item.append("span")
                .attr("class", "legend-label")
                .text(s.displayName);
        });

        console.log("‚úÖ Google Ads chart completed successfully!");
    </script>
</body>
</html>